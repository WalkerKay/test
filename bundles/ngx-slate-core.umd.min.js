!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("slate-plain-serializer"),require("slate-base64-serializer"),require("@angular/cdk/keycodes"),require("slate-hotkeys"),require("get-window"),require("slate-dev-environment"),require("slate"),require("rxjs"),require("rxjs/operators"),require("debug"),require("@angular/platform-browser"),require("@angular/cdk/portal"),require("@angular/core"),require("tiny-warning")):"function"==typeof define&&define.amd?define("@ngx-slate/core",["exports","slate-plain-serializer","slate-base64-serializer","@angular/cdk/keycodes","slate-hotkeys","get-window","slate-dev-environment","slate","rxjs","rxjs/operators","debug","@angular/platform-browser","@angular/cdk/portal","@angular/core","tiny-warning"],t):t((e["ngx-slate"]=e["ngx-slate"]||{},e["ngx-slate"].core={}),e.Plain,e.Base64,e.ng.cdk.keycodes,e.Hotkeys,e.getWindow,e.slateDevEnvironment,e.slate,e.rxjs,e.rxjs.operators,e.Debug,e.ng.platformBrowser,e.ng.cdk.portal,e.ng.core,e.warning)}(this,function(e,w,R,g,v,q,K,b,r,n,t,o,a,h,m){"use strict";w=w&&w.hasOwnProperty("default")?w["default"]:w,R=R&&R.hasOwnProperty("default")?R["default"]:R,v=v&&v.hasOwnProperty("default")?v["default"]:v,q=q&&q.hasOwnProperty("default")?q["default"]:q,t=t&&t.hasOwnProperty("default")?t["default"]:t,m=m&&m.hasOwnProperty("default")?m["default"]:m;var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function s(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var d=function(){return(d=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function y(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function O(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(o=a.next()).done;)i.push(o.value)}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=a["return"])&&n.call(a)}finally{if(r)throw r.error}}return i}function p(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(O(arguments[t]));return e}var l=[{name:"blur",handler:"onBlur",isTriggerBeforeInput:!0},{name:"compositionstart",handler:"onCompositionStart",isTriggerBeforeInput:!0},{name:"compositionupdate",handler:null,isTriggerBeforeInput:!0},{name:"compositionend",handler:"onCompositionEnd",isTriggerBeforeInput:!0},{name:"keydown",handler:"onKeyDown",isTriggerBeforeInput:!0},{name:"keypress",handler:null,isTriggerBeforeInput:!0},{name:"keyup",handler:"onKeyUp",isTriggerBeforeInput:!0},{name:"mousedown",handler:"onMouseDown",isTriggerBeforeInput:!0},{name:"textInput",handler:null,isTriggerBeforeInput:!0},{name:"paste",handler:"onPaste",isTriggerBeforeInput:!0},{name:"click",handler:"onClick",isTriggerBeforeInput:!1},{name:"contextmenu",handler:"onContextMenu",isTriggerBeforeInput:!1},{name:"copy",handler:"onCopy",isTriggerBeforeInput:!1},{name:"cut",handler:"onCut",isTriggerBeforeInput:!1},{name:"focus",handler:"onFocus",isTriggerBeforeInput:!1},{name:"cut",handler:"onCut",isTriggerBeforeInput:!1},{name:"mouseup",handler:"onMouseUp",isTriggerBeforeInput:!1},{name:"select",handler:"onSelect",isTriggerBeforeInput:!1},{name:"drop",handler:"onDrop",isTriggerBeforeInput:!1}],c=p(["onBeforeInput","onBlur","onClick","onContextMenu","onCompositionEnd","onCompositionStart","onCopy","onCut","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onInput","onFocus","onKeyDown","onKeyUp","onMouseDown","onMouseUp","onPaste","onSelect"],["commands","decorateNode","queries","renderAnnotation","renderBlock","renderDecoration","renderDocument","renderEditor","renderInline","renderMark","schema"]);var u={FRAGMENT:"application/x-slate-fragment",HTML:"text/html",NODE:"application/x-slate-node",RICH:"text/rtf",TEXT:"text/plain"};var x="data-slate-fragment",C="data-key",I="data-slate-length",f="data-slate-object",E="data-slate-spacer",S="data-slate-zero-width",N={BLOCK:"["+f+'="block"]',EDITOR:"["+"data-slate-editor"+"]",INLINE:"["+f+'="inline"]',KEY:"["+C+"]",LEAF:"["+"data-slate-leaf"+"]",OBJECT:"["+f+"]",STRING:"["+"data-slate-string"+"]",TEXT:"["+f+'="text"]',VOID:"["+"data-slate-void"+"]",ZERO_WIDTH:"["+S+"]",SKIP_EVENT:"["+"skip-slate-event"+"]"},T=u.FRAGMENT,B=u.HTML,A=u.TEXT;function k(e,t,n){void 0===n&&(n=function(){return undefined});var o=q(e.target),r=o.getSelection(),a=t.value,i=a.document,s=a.fragment,d=a.selection,l=d.start,c=d.end,u=i.getClosestVoid(l.path,t),f=i.getClosestVoid(c.path,t);if(!r.isCollapsed||u){var p,h,g,v=R.serializeNode(s),m=r.getRangeAt(0),y=m.cloneContents(),C=y.childNodes[0];y.childNodes.forEach(function(e){e.textContent&&""!==e.textContent.trim()&&(C=e)}),f&&(p=m.cloneRange(),h=t.findDOMNode(i.getPath(f)),p.setEndAfter(h),y=p.cloneContents()),u&&(C=y.childNodes[0].childNodes[1].firstChild),[].slice.call(y.querySelectorAll(N.ZERO_WIDTH)).forEach(function(e){var t="n"===e.getAttribute(S);e.textContent=t?"\n":""}),3===C.nodeType&&((g=o.document.createElement("span")).style.whiteSpace="pre",g.appendChild(C),y.appendChild(g),C=g),C.setAttribute(x,v);var I=b.Value.create({document:s}),E=w.serialize(I),k=o.document.createElement("div");if(k.appendChild(y),e.clipboardData&&e.clipboardData.setData&&!K.IS_IE)return e.preventDefault(),e.clipboardData.setData(A,E),e.clipboardData.setData(T,v),e.clipboardData.setData(B,k.innerHTML),void n();var D=e.target.closest(N.EDITOR);k.setAttribute("contenteditable",!0),k.style.position="absolute",k.style.left="-9999px",D.appendChild(k),r.selectAllChildren(k),o.requestAnimationFrame(function(){var e,t;D.removeChild(k),e=r,K.IS_IE?((t=window.document.body.createTextRange()).collapse(),t.select()):e.removeAllRanges(),r.addRange(m),n()})}}var D=u.FRAGMENT,P=u.HTML,F=u.NODE,M=u.RICH,L=u.TEXT,V=/ data-slate-fragment="([^\s"]+)"/;function j(e){!K.IS_IE&&e.nativeEvent&&(e=e.nativeEvent);var t,n,o,r,a=e.dataTransfer||e.clipboardData,i=W(a,D),s=W(a,F),d=W(a,P),l=W(a,M),c=W(a,L);!i&&d&&~d.indexOf(" "+x+'="')&&((n=O(V.exec(d),2))[0],(o=n[1])&&(i=o)),c&&((r=function(e){var t="SLATE-DATA-EMBED::";if(e.substring(0,t.length)!==t)return{TEXT:e};try{return JSON.parse(e.substring(t.length))}catch(n){throw new Error("Unable to parse custom Slate drag event data.")}}(c))[D]&&(i=r[D]),r[F]&&(s=r[F]),r[L]&&(c=r[L])),i=i&&R.deserializeNode(i),s=s&&R.deserializeNode(s);try{a.items&&a.items.length?t=Array.from(a.items).map(function(e){return"file"===e.kind?e.getAsFile():null}).filter(function(e){return e}):a.files&&a.files.length&&(t=Array.from(a.files))}catch(p){a.files&&a.files.length&&(t=Array.from(a.files))}var u,f={files:t,fragment:i,html:d,node:s,rich:l,text:c};return f.type=(u=f).fragment?"fragment":u.node?"node":u.rich&&u.html?"html":u.rich&&u.text?"text":u.files&&u.files.length?"files":u.html?"html":u.text?"text":"unknown",f}function W(e,t){return e.types&&e.types.length?-1!==Array.from(e.types).indexOf(t)&&e.getData(t)||null:t===L&&e.getData("Text")||null}var U=u.TEXT;var _=t("slate:after");_.beforeInput=t("slate:after-before-input");var Z=(H.onBeforeInput=function(e,t,n){var o=t.value;if(e.nativeEvent)return _.beforeInput("onBeforeInput",{event:e}),""===t.value.anchorText.text?setTimeout(function(){t.insertText(e.data)}):(e.nativeEvent.preventDefault(),t.insertText(e.data)),n();var r=O(e.getTargetRanges(),1)[0];if(!r)return n();_("onBeforeInput",{event:e}),e.preventDefault();var a=o.document,i=o.selection,s=t.findRange(r);switch(e.inputType){case"deleteByDrag":case"deleteByCut":case"deleteContent":case"deleteContentBackward":case"deleteContentForward":t.deleteAtRange(s);break;case"deleteWordBackward":t.deleteWordBackwardAtRange(s);break;case"deleteWordForward":t.deleteWordForwardAtRange(s);break;case"deleteSoftLineBackward":case"deleteHardLineBackward":t.deleteLineBackwardAtRange(s);break;case"deleteSoftLineForward":case"deleteHardLineForward":t.deleteLineForwardAtRange(s);break;case"insertLineBreak":case"insertParagraph":a.hasVoidParent(i.start.path,t)?t.moveToStartOfNextText():t.splitBlockAtRange(s);break;case"insertFromYank":case"insertReplacementText":case"insertText":var d=null==e.data?e.dataTransfer.getData("text/plain"):e.data;if(null==d)break;t.insertTextAtRange(s,d,i.marks),i.marks&&o.document!==t.value.document&&t.select({marks:null})}n()},H.onBlur=function(e,t,n){_("onBlur",{event:e}),t.blur(),n()},H.onClick=function(e,t,n){if(t.readOnly)return n();var o=t.value.document,r=t.findPath(e.target);if(!r)return n();_("onClick",{event:e});var a=o.getNode(r),i=o.getAncestors(r);a&&(t.isVoid(a)||i.some(function(e){return t.isVoid(e)}))&&t.focus().moveToEndOfNode(a),n()},H.onCopy=function(e,t,n){_("onCopy",{event:e}),k(e,t),n()},H.onCut=function(e,p,t){_("onCut",{event:e}),k(e,p,function(){var e,t,n,o=p.value,r=o.document,a=o.selection,i=a.end;if(a.isCollapsed)try{for(var s=y(r.ancestors(i.path)),d=s.next();!d.done;d=s.next()){var l=O(d.value,2),c=l[0],u=l[1];if(p.isVoid(c)){n=u;break}}}catch(f){e={error:f}}finally{try{d&&!d.done&&(t=s["return"])&&t.call(s)}finally{if(e)throw e.error}}n?p.removeNodeByKey(n):p["delete"]()}),t()},H.onDragEnd=function(e,t,n){_("onDragEnd",{event:e}),H.isDraggingInternally=null,n()},H.onDragStart=function(e,t,n){_("onDragStart",{event:e}),H.isDraggingInternally=!0;var o=t.value,r=o.document,a=t.findPath(e.target),i=r.getNode(a),s=r.getAncestors(a),d=i&&(t.isVoid(i)||s.some(function(e){return t.isVoid(e)})),l=o.blocks.some(function(e){return e===i});d&&!l&&t.moveToRangeOfNode(i);var c=t.value.fragment;!function(e,t,n){var o=u[t.toUpperCase()];if(!o)throw new Error('Cannot set unknown transfer type "'+o+'".');e.nativeEvent&&(e=e.nativeEvent);var r=e.dataTransfer||e.clipboardData;try{r.setData(o,n),r.setData("text",r.getData("text"))}catch(l){var a="SLATE-DATA-EMBED::",i=r.getData(U),s={};if(i.substring(0,a.length)===a)try{s=JSON.parse(i.substring(a.length))}catch(c){throw new Error("Failed to parse Slate data from `DataTransfer` object.")}else s[U]=i;s[o]=n;var d=a+JSON.stringify(s);r.setData(U,d)}}(e,"fragment",R.serializeNode(c)),n()},H.onDrop=function(e,n,t){var o,r=n.value,a=r.document,i=r.selection,s=q(e.target),d=n.findEventRange(e);if(!d)return t();_("onDrop",{event:e});var l=j(e),c=l.type,u=l.fragment,f=l.text;if(n.focus(),H.isDraggingInternally&&i.end.offset<d.end.offset&&i.end.path.equals(d.end.path)&&(d=d.moveForward(i.start.path.equals(i.end.path)?0-i.end.offset+i.start.offset:0-i.end.offset)),H.isDraggingInternally&&n["delete"](),n.select(d),"text"===c||"html"===c){var p=d.anchor,h=a.hasVoidParent(p.path,n);if(h){for(var g=p.path,v=a.getNode(p.path);h;){var m=O(a.texts({path:g}),1)[0];if(!m)break;v=(o=O(m,2))[0],g=o[1],h=a.hasVoidParent(g,n)}v&&n.moveToStartOfNode(v)}f&&f.split("\n").forEach(function(e,t){0<t&&n.splitBlock(),n.insertText(e)})}"fragment"===c&&n.insertFragment(u);var y=n.findDOMNode(d.focus.path);y&&y.dispatchEvent(new MouseEvent("mouseup",{view:s,bubbles:!0,cancelable:!0})),t()},H.onFocus=function(e,t,n){_("onFocus",{event:e}),!H.isMouseDown||K.IS_IE||K.IS_EDGE?t.focus():t.deselect().focus(),n()},H.onInput=function(e,t,n){_("onInput");var o=q(e.target).getSelection(),r=t.findSelection(o);r?t.select(r):t.blur();var a=o.anchorNode;t.reconcileDOMNode(a),n()},H.onKeyDown=function(e,t,n){_("onKeyDown",{event:e});var o=t.value,r=o.document,a=o.selection,i=a.start,s=r.hasVoidParent(i.path,t);if(v.isSplitBlock(e)&&!K.IS_IOS)return s?t.moveToStartOfNextText():t.splitBlock();if(v.isDeleteBackward(e)&&!K.IS_IOS)return t.deleteCharBackward();if(v.isDeleteForward(e)&&!K.IS_IOS)return t.deleteCharForward();if(v.isDeleteLineBackward(e))return t.deleteLineBackward();if(v.isDeleteLineForward(e))return t.deleteLineForward();if(v.isDeleteWordBackward(e))return t.deleteWordBackward();if(v.isDeleteWordForward(e))return t.deleteWordForward();if(v.isRedo(e))return t.redo();if(v.isUndo(e))return t.undo();if(v.isMoveLineBackward(e))return e.preventDefault(),t.moveToStartOfBlock();if(v.isMoveLineForward(e))return e.preventDefault(),t.moveToEndOfBlock();if(v.isExtendLineBackward(e))return e.preventDefault(),t.moveFocusToStartOfBlock();if(v.isExtendLineForward(e))return e.preventDefault(),t.moveFocusToEndOfBlock();if(v.isMoveBackward(e))return e.preventDefault(),a.isCollapsed?t.moveBackward():t.moveToStart();if(v.isMoveForward(e))return e.preventDefault(),a.isCollapsed?t.moveForward():t.moveToEnd();if(v.isMoveWordBackward(e))return e.preventDefault(),t.moveWordBackward();if(v.isMoveWordForward(e))return e.preventDefault(),t.moveWordForward();if(v.isExtendBackward(e)){var d,l=r.getNode(i.path),c=O(r.texts({path:i.path,direction:"backward"}),1)[0],u=!1;if(c&&(d=O(c,2)[1],u=r.hasVoidParent(d,t)),s||u||""===l.text)return e.preventDefault(),t.moveFocusBackward()}if(v.isExtendForward(e)){var f,l=r.getNode(i.path),p=O(r.texts({path:i.path}),1)[0],h=!1;if(p&&(f=O(p,2)[1],h=r.hasVoidParent(f,t)),s||h||""===l.text)return e.preventDefault(),t.moveFocusForward()}if(e.keyCode===g.TAB)return e.preventDefault(),t.insertText("    ");n()},H.onMouseDown=function(e,t,n){_("onMouseDown",{event:e}),H.isMouseDown=!0,n()},H.onMouseUp=function(e,t,n){_("onMouseUp",{event:e}),H.isMouseDown=!1,n()},H.onPaste=function(e,t,n){_("onPaste",{event:e});var o=t.value,r=j(e),a=r.type,i=r.fragment,s=r.text;if("fragment"===a&&t.insertFragment(i),"text"===a||"html"===a){if(!s)return n();var d=o.document,l=o.selection,c=o.startBlock;if(t.isVoid(c))return n();var u=c,f=d.getInsertMarksAtRange(l),p=w.deserialize(s,{defaultBlock:u,defaultMarks:f}).document;t.insertFragment(p)}n()},H.onSelect=function(e,t,n){_("onSelect",{event:e});var o,r=q(e.target).getSelection();r.rangeCount?t.findRange(r)&&(o=t.findSelection(r),t.select(o)):t.blur(),H.isMouseDown=!1,n()},H.isDraggingInternally=null,H.isMouseDown=!1,H);function H(){}var z=t("slate:before");z.track=t("slate:track");var X=(J.onBeforeInput=function(e,t,n){e.nativeEvent,t.readOnly||(z("onBeforeInput",{event:e}),n())},J.onBlur=function(e,t,n){if(!J.isCopying&&!t.readOnly){var o=e.relatedTarget,r=e.target,a=q(r);if(J.activeElement!==a.document.activeElement){if(o){var i=t.findDOMNode([]);if(o===i)return;if(o.hasAttribute(E))return;var s=t.findNode(o);if(i.contains(o)&&s&&!t.isVoid(s))return}z("onBlur",{event:e}),n()}}},J.onCompositionEnd=function(e,t,n){var o=J.compositionCount;window.setTimeout(function(){o<J.compositionCount||(J.isComposing=!1)},100),z("onCompositionEnd",{event:e}),n()},J.onClick=function(e,t,n){z("onClick",{event:e}),n()},J.onCompositionStart=function(e,t,n){J.isComposing=!0,J.compositionCount++,t.value.selection.isCollapsed||t["delete"](),z("onCompositionStart",{event:e}),n()},J.onCopy=function(e,t,n){var o=q(e.target);J.isCopying=!0,o.requestAnimationFrame(function(){return J.isCopying=!1}),z("onCopy",{event:e}),n()},J.onCut=function(e,t,n){var o;t.readOnly||(o=q(e.target),J.isCopying=!0,o.requestAnimationFrame(function(){return J.isCopying=!1}),z("onCut",{event:e}),n())},J.onDragEnd=function(e,t,n){J.isDragging=!1,z("onDragEnd",{event:e}),n()},J.onDragEnter=function(e,t,n){z("onDragEnter",{event:e}),n()},J.onDragExit=function(e,t,n){z("onDragExit",{event:e}),n()},J.onDragLeave=function(e,t,n){z("onDragLeave",{event:e}),n()},J.onDragOver=function(e,t,n){var o=t.findNode(e.target);o&&!t.isVoid(o)||e.preventDefault(),K.IS_IE&&e.preventDefault(),J.isDragging||(J.isDragging=!0,K.IS_IE||(e.nativeEvent.dataTransfer.dropEffect="move")),z("onDragOver",{event:e}),n()},J.onDragStart=function(e,t,n){J.isDragging=!0,z("onDragStart",{event:e}),n()},J.onDrop=function(e,t,n){t.readOnly||(e.preventDefault(),z("onDrop",{event:e}),n())},J.onFocus=function(e,t,n){var o,r;J.isCopying||t.readOnly||(o=t.findDOMNode([]),r=q(e.target),J.activeElement=r.document.activeElement,K.IS_FIREFOX&&e.target!==o?o.focus():(z("onFocus",{event:e}),n()))},J.onInput=function(e,t,n){J.isComposing||t.value.selection.isBlurred||(z("onInput",{event:e}),n())},J.onKeyDown=function(e,t,n){t.readOnly||(J.isComposing?v.isCompose(e)&&e.preventDefault():(!K.IS_IOS&&(v.isBold(e)||v.isDeleteBackward(e)||v.isDeleteForward(e)||v.isDeleteLineBackward(e)||v.isDeleteLineForward(e)||v.isDeleteWordBackward(e)||v.isDeleteWordForward(e)||v.isItalic(e)||v.isRedo(e)||v.isSplitBlock(e)||v.isTransposeCharacter(e)||v.isUndo(e))&&e.preventDefault(),z("onKeyDown",{event:e}),z.track("track start : onKeyDown"),n()))},J.onPaste=function(e,t,n){t.readOnly||(e.preventDefault(),z("onPaste",{event:e}),n())},J.onSelect=function(e,t,n){var o;J.isCopying||J.isComposing||t.readOnly||(o=q(e.target),J.activeElement=o.document.activeElement,z("onSelect",{event:e}),n())},J.activeElement=null,J.compositionCount=0,J.isComposing=!1,J.isCopying=!1,J.isDragging=!1,J);function J(){}function G(){}var Y={commands:(G.reconcileNode=function(e,t){var n,o=e.value,r=o.document,a=o.selection,i=r.getPath(t.key),s=e.findDOMNode(i),d=r.getClosestBlock(i),l=t.text,c=s.textContent,u=d.nodes.last()===t,f=c.charAt(c.length-1);u&&"\n"===f&&(c=c.slice(0,-1)),l!==c&&(n=a.moveAnchorTo(i,0).moveFocusTo(i,l.length),n=r.resolveRange(n),e.insertTextAtRange(n,c,t.marks))},G.reconcileDOMNode=function(e,t){var n=t.parentElement.closest("[data-key]"),o=e.findNode(n);e.reconcileNode(o)},G.removeMarkOrigin=function(e,t){var n,o,r=e.value,a=r.document,i=r.selection;r.anchorText,i.isExpanded?e.removeMarkAtRange(i,t):(n=i.marks?i.marks.remove(t):a.getActiveMarksAtRange(i).remove(t),o=i.set("marks",n),e.select(o))},G.removeMark=function(e,t){var n,o,r=e.value,a=r.document,i=r.selection,s=r.anchorText;i.isExpanded?e.removeMarkAtRange(i,t):(n=i.marks?i.marks.remove(t):a.getActiveMarksAtRange(i).remove(t),o=i.set("marks",n),e.select(o)),i.isCollapsed&&"​"===s.text&&e.removeMarkByPath(i.start.path,0,1,t),i.isCollapsed&&"​"!==s.text&&""!==s.text&&e.insertText("​")},G.addMark=function(e,t){var n,o,r=e.value,a=r.document,i=r.selection,s=r.anchorText;i.isExpanded?e.addMarkAtRange(i,t):(n=i.marks?i.marks.add(t):a.getActiveMarksAtRange(i).add(t),o=i.set("marks",n),e.select(o)),i.isCollapsed&&"​"===s.text&&e.addMarkByPath(i.start.path,0,1,t),i.isCollapsed&&"​"!==s.text&&""!==s.text&&e.insertText("​")},G)};function $(){}function Q(e,t,n){for(var o=e.childNodes,r=o[t],a=t,i=!1,s=!1;(8===r.nodeType||1===r.nodeType&&0===r.childNodes.length||1===r.nodeType&&"false"===r.getAttribute("contenteditable"))&&(!i||!s);)a>=o.length?(i=!0,a=t-1,n="backward"):a<0?(s=!0,a=t+1,n="forward"):(r=o[a],"forward"===n&&a++,"backward"===n&&a--);return r||null}var ee={queries:($.findDOMNode=function(e,t){t=b.PathUtils.create(t);var n=e.tmp.contentRef;if(!n)return null;if(!t.size)return n.rootNode||null;var a=function(e,t){if(!e)return null;if(!t.size)return e.rootNode||null;var n=t.first(),o=t.rest(),r=e.getNodeRef(n);return a(r,o)},o=n.nodeRef;return a(o,t)},$.findDOMPoint=function(e,t){var n,o,r=e.findDOMNode(t.path),a=0;if(!r)return null;var i=Array.from(r.querySelectorAll(N.STRING+", "+N.ZERO_WIDTH));try{for(var s=y(i),d=s.next();!d.done;d=s.next()){var l=d.value,c=l.childNodes[0],u=c.textContent.length,f=u;l.hasAttribute(I)&&(f=parseInt(l.getAttribute(I),10));var p=a+f;if(t.offset<=p){var h=Math.min(u,Math.max(0,t.offset-a));return 0===h&&1===u&&"​"===c.textContent?{node:c,offset:h+1}:{node:c,offset:h}}a=p}}catch(g){n={error:g}}finally{try{d&&!d.done&&(o=s["return"])&&o.call(s)}finally{if(n)throw n.error}}return null},$.findDOMRange=function(e,t){var n=t.anchor,o=t.focus,r=t.isBackward,a=t.isCollapsed,i=e.findDOMPoint(n),s=a?i:e.findDOMPoint(o);if(!i||!s)return null;var d=q(i.node).document.createRange(),l=r?s:i,c=r?i:s;return d.setStart(l.node,l.offset),d.setEnd(c.node,c.offset),d},$.findNode=function(e,t){var n=e.findPath(t);return n?e.value.document.getNode(n):null},$.findEventRange=function(e,t){t.nativeEvent&&(t=t.nativeEvent);var n=t.clientX,o=t.clientY,r=t.target;if(null==n||null==o)return null;var a=e.value.document,i=e.findPath(t.target);if(!i)return null;var s=a.getNode(i);if(e.isVoid(s)){var d=r.getBoundingClientRect(),l="inline"===s.object?n-d.left<d.left+d.width-n:o-d.top<d.top+d.height-o,c=a.createRange(),u=l?"moveToEndOfNode":"moveToStartOfNode",f=a[l?"getPreviousText":"getNextText"](i);return f?c[u](f):null}var p=q(r);if(p.document.caretRangeFromPoint)h=p.document.caretRangeFromPoint(n,o);else if(p.document.caretPositionFromPoint){var h,g=p.document.caretPositionFromPoint(n,o);(h=p.document.createRange()).setStart(g.offsetNode,g.offset),h.setEnd(g.offsetNode,g.offset)}else if(p.document.body.createTextRange){h=p.document.body.createTextRange();try{h.moveToPoint(n,o)}catch(v){return null}}return e.findRange(h)},$.findPath=function(e,t){var n=e.tmp.contentRef,u=t;if(u.hasAttribute(C)||(u=u.closest(N.KEY)),!u||!u.getAttribute(C))return null;if(u===n.rootNode)return b.PathUtils.create([]);var f=function(e,t){var n,o;if(u===e.rootNode)return t;if(!e.nodeRefs)return null;var r=e.nodeRefs,a=0;try{for(var i=y(r),s=i.next();!s.done;s=i.next()){var d=s.value,l=f(d,p(t,[a]));if(a++,l)return l}}catch(c){n={error:c}}finally{try{s&&!s.done&&(o=i["return"])&&o.call(i)}finally{if(n)throw n.error}}return null},o=n.nodeRef,r=f(o,[]);return r?b.PathUtils.create(r):null},$.findPoint=function(e,t,n){var o,r,a,i=function(e,t){if(1===e.nodeType&&e.childNodes.length){var n=t===e.childNodes.length,o=n?"backward":"forward";for(e=Q(e,n?t-1:t,o);1===e.nodeType&&e.childNodes.length;){var r=n?e.childNodes.length-1:0;e=Q(e,r,o)}t=n?e.textContent.length:0}return{node:e,offset:t}}(t,n),s=i.node,d=i.offset,l=q(t),c=s.parentNode,u=c.closest(N.LEAF);if(u){o=u.closest(N.TEXT);var f=l.document.createRange();f.setStart(o,0),f.setEnd(s,d);var p=f.cloneContents(),h=p.querySelectorAll(N.ZERO_WIDTH);Array.from(h).forEach(function(e){e.parentNode.removeChild(e)}),r=p.textContent.length,a=o}else{var g=c.closest(N.VOID);if(!g)return null;if(!(u=g.querySelector(N.LEAF)))return null;o=u.closest(N.TEXT),r=(a=u).textContent.length}r===a.textContent.length&&c.hasAttribute(S)&&r--;var v=e.findPath(o);return v?e.value.document.createPoint({path:v,offset:r}):null},$.findRange=function(e,t){var n=t.anchorNode||t.startContainer;if(!n)return null;var o=q(n);(t instanceof o.Range||o.StaticRange&&t instanceof o.StaticRange)&&(t={anchorNode:t.startContainer,anchorOffset:t.startOffset,focusNode:t.endContainer,focusOffset:t.endOffset});var r=t.anchorNode,a=t.anchorOffset,i=t.focusNode,s=t.focusOffset,d=t.isCollapsed,l=e.value,c=e.findPoint(r,a),u=d?c:e.findPoint(i,s);return c&&u?l.document.createRange({anchor:c,focus:u}):null},$.findSelection=function(e,t){var n=e.value,o=n.document;if(!t.rangeCount)return null;var r=e.findRange(t);if(!r)return null;var a,i,s,d,l,c,u,f,p,h,g,v,m=r.anchor,y=r.focus,C=o.getNode(m.path),I=o.getNode(y.path),E=o.getClosestInline(m.path),k=o.getClosestInline(y.path),D=o.getClosestBlock(y.path),w=o.getClosestBlock(m.path);w&&!e.isVoid(w)&&0===m.offset&&D&&e.isVoid(D)&&0!==y.offset&&(r=r.setFocus(y.setOffset(0))),E&&!e.isVoid(E)&&(s=o.getClosestBlock(m.path),d=o.getDepth(s.key),l=b.PathUtils.drop(m.path,d),m.offset===C.text.length?(c=O(s.texts({path:l}),1)[0])&&(u=O(c,2)[1],v=m.path.slice(0,d).concat(u),r=r.moveAnchorTo(v,0)):0!==m.offset||(a=O(s.texts({path:l,direction:"backward"}),1)[0])&&(h=(i=O(a,2))[0],g=i[1],v=m.path.slice(0,d).concat(g),r=r.moveAnchorTo(v,h.text.length))),k&&!e.isVoid(k)&&(s=o.getClosestBlock(y.path),d=o.getDepth(s.key),l=b.PathUtils.drop(y.path,d),y.offset===I.text.length?(c=O(s.texts({path:l}),1)[0])&&(u=O(c,2)[1],v=y.path.slice(0,d).concat(u),r=r.moveFocusTo(v,0)):0!==y.offset||(f=O(s.texts({path:l,direction:"backward"}),1)[0])&&(h=(p=O(f,2))[0],g=p[1],v=y.path.slice(0,d).concat(g),r=r.moveFocusTo(v,h.text.length)));var R=o.createSelection(r);return R=(R=R.setIsFocused(!0)).set("marks",n.selection.marks)},$)};function te(e){var n;return void 0===e&&(e={}),[(void 0===(n=e)&&(n={}),c.reduce(function(e,t){return t in n&&n[t]&&(e[t]=n[t]),e},{})),function(e){void 0===e&&(e={});var t=e.plugins;return p([X],void 0===t?[]:t,[Z])}(e),Y,ee]}var ne=["auto","overlay","scroll"],oe=K.IS_IOS&&!!window.navigator.userAgent.match(/os 11_/i);function re(e){var t,n,o,r,a,i,s,d,l,c,u,f,p,h,g,v,m,y,C,I,E,k,D,w,R,b,O,x,S,N,T,B,A,P,F,M,L,V,j,W,U,_;oe||e.anchorNode&&(t=q(e.anchorNode),o=(n=function(e,t){for(var n,o=e.parentNode;!n&&o.parentNode;){var r=t.getComputedStyle(o).overflowY;if(ne.includes(r)){n=o;break}o=o.parentNode}return n||t.document.body}(e.anchorNode,t))===t.document.body||n===t.document.documentElement,i=(a=e).anchorNode,s=a.anchorOffset,d=a.focusNode,l=a.focusOffset,r=!(4===(c=i.compareDocumentPosition(d))||0===c&&s<l),(u=e.getRangeAt(0).cloneRange()).collapse(r),f=u.getBoundingClientRect(),K.IS_SAFARI&&u.collapsed&&0===f.top&&0===f.height&&(0===u.startOffset?u.setEnd(u.endContainer,1):u.setStart(u.startContainer,u.startOffset-1),0===(f=u.getBoundingClientRect()).top&&0===f.height&&u.getClientRects().length&&(f=u.getClientRects()[0])),I=C=y=m=v=g=h=p=0,w=o?(E=t.innerWidth,k=t.innerHeight,D=t.pageYOffset,t.pageXOffset):(R=n.offsetWidth,b=n.offsetHeight,O=n.scrollTop,x=n.scrollLeft,N=(S=t.getComputedStyle(n)).borderTopWidth,T=S.borderBottomWidth,B=S.borderLeftWidth,A=S.borderRightWidth,P=S.paddingTop,F=S.paddingBottom,M=S.paddingLeft,L=S.paddingRight,E=R,k=b,p=(V=n.getBoundingClientRect()).top+parseInt(N,10),h=V.left+parseInt(B,10),g=parseInt(N,10)+parseInt(T,10),v=parseInt(B,10)+parseInt(A,10),m=parseInt(P,10),y=parseInt(F,10),C=parseInt(M,10),I=parseInt(L,10),D=O,x),j=f.top+D-p,_=D,(W=f.left+w-h)<(U=w)?U=W-C:W+f.width+v>w+E&&(U=W+v+I-E),j<D?_=j-m:j+f.height+g>D+k&&(_=j+g+y+f.height-k),o?t.scrollTo(U,_):(n.scrollTop=_,n.scrollLeft=U))}var ae=!("undefined"==typeof window||"undefined"==typeof window.document||"undefined"==typeof window.document.createElement),ie="blur",se="compositionend",de="keydown",le="keypress",ce="keyup",ue="mousedown",fe="textInput",pe="paste",he=null,ge=null,ve=null;function me(){if(ve)return ve;for(var e=ge,t=e.length,n=function(){if("value"in he)return he.value;return he.textContent}(),o=n.length,r=0;r<t&&e[r]===n[r];r++);for(var a=t-r,i=1;i<=a&&e[t-i]===n[o-i];i++);var s=1<i?1-i:undefined;return ve=n.slice(r,s)}var ye=function(){this.data=null},Ce=[9,13,27,32],Ie=229,Ee=!1,ke=ae&&"CompositionEvent"in window,De=null;ae&&"documentMode"in document&&(De=document.documentMode);var we=ae&&"TextEvent"in window&&!De,Re=ae&&(!ke||De&&8<De&&De<=11),be=32,Oe=String.fromCharCode(be),xe=!1;var Se=!1;function Ne(e,t){if(Se){if(e===se||!ke&&function(e,t){switch(e){case ce:return-1!==Ce.indexOf(t.keyCode);case de:return t.keyCode!==Ie;case le:case ue:case ie:return 1;default:return}}(e,t)){var n=me();return ve=ge=he=null,Se=!1,n}return null}switch(e){case pe:return null;case le:if(!((o=t).ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(t["char"]&&1<t["char"].length)return t["char"];if(t.which)return String.fromCharCode(t.which)}return null;case se:return Re&&"ko"!==t.locale?null:t.data;default:return null}var o}function Te(e,t,n){var o=(we?function(e,t){switch(e){case se:return Ee?void(Ee=!1):"object"==typeof(r=(o=t).detail)&&"data"in r?r.data:o.data?o.data:null;case le:return t.which!==be?null:(xe=!0,Oe);case fe:var n=t.data;return n===Oe&&xe?null:(Ee=!0,n);default:return null}var o,r}:Ne)(e,n);if(!o)return null;var r=new ye;return r.data=o,r.nativeEvent=n,r}var Be=function(e,t,n,o){var r=Te(e,0,n);return null===r?null:r},Ae=function(){},Pe=function(){},Fe=function(e,t){this.rootNode=e,this.componentRef=t},Me=function(){};var Le=(Object.defineProperty(Ve.prototype,"node",{get:function(){return this.internalNode},set:function(e){this.internalNode=e,this.nodeComponentRef&&(this.nodeComponentRef.componentRef.instance.node=this.internalNode)},enumerable:!0,configurable:!0}),Ve.prototype.ngOnInit=function(){this.render(),this.key=this.node.key,"inline"===this.node.object&&(this.elementRef.nativeElement.contentEditable="false")},Ve.prototype.createElement=function(){var e="block"===this.node.object?"div":"span";return document.createElement(e)},Ve.prototype.render=function(){this.readOnly?this.children.remove():this.elementRef.nativeElement.appendChild(this.renderSpacer()),this.elementRef.nativeElement.appendChild(this.renderContent())},Ve.prototype.renderSpacer=function(){var e,t=((e={})[E]="true",e),n=this.createElement();return function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])}(n,{height:"0",color:"transparent",outline:"none",position:"absolute"}),function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n])}(n,t),n.appendChild(this.nodeRefs.first.rootNode),n},Ve.prototype.renderContent=function(){var e=this.createElement();return e.setAttribute("contentEditable",this.readOnly?null:"false"),e.appendChild(this.children),e},Ve.decorators=[{type:h.Component,args:[{selector:"div[slaVoid]",template:""}]}],Ve.ctorParameters=function(){return[{type:h.ViewContainerRef},{type:h.ElementRef}]},Ve.propDecorators={editor:[{type:h.Input}],selection:[{type:h.Input}],parent:[{type:h.Input}],block:[{type:h.Input}],decorations:[{type:h.Input}],annotations:[{type:h.Input}],children:[{type:h.Input}],nodeRef:[{type:h.Input}],readOnly:[{type:h.Input}],nodeRefs:[{type:h.Input}],node:[{type:h.Input}],"void":[{type:h.HostBinding,args:["attr.data-slate-void"]}],key:[{type:h.HostBinding,args:["attr.data-key"]}]},Ve);function Ve(e,t){this.viewContainerRef=e,this.elementRef=t,this.readOnly=!1,this["void"]="true",this.key=""}var je=(We.prototype.renderDom=function(e,t,n,o){var r,a,i=document.createElement(e);if(this.setNodeAttributes(i,n),o&&this.setNodeStyles(i,o),t instanceof HTMLCollection){for(var s=0;s<t.length;s++){var d=t.item(s);i.appendChild(d)}return i}if(t instanceof HTMLElement)return i.appendChild(t),i;if(t instanceof h.QueryList){var l=t.toArray();try{for(var c=y(l),u=c.next();!u.done;u=c.next()){var f=u.value;i.appendChild(f.rootNode)}}catch(p){r={error:p}}finally{try{u&&!u.done&&(a=c["return"])&&a.call(c)}finally{if(r)throw r.error}}return i}return i},We.prototype.renderComponent=function(e,t){var n=this.cfr.resolveComponentFactory(e),o=t.nodeViewContainerRef.createComponent(n);return Object.assign(o.instance,d({},t)),o.changeDetectorRef.detectChanges(),new Fe(this.getComponentRootNode(o),o)},We.prototype.setNodeAttributes=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n])},We.prototype.setNodeStyles=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])},We.prototype.getComponentRootNode=function(e){return e.hostView.rootNodes[0]},We.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],We.ctorParameters=function(){return[{type:h.ComponentFactoryResolver}]},We.ngInjectableDef=h.ɵɵdefineInjectable({factory:function(){return new We(h.ɵɵinject(h.ComponentFactoryResolver))},token:We,providedIn:"root"}),We);function We(e){this.cfr=e}var Ue=t("slate:node");Ue.render=t("slate:node-render"),Ue.check=t("slate:docheck"),Ue.change=t("slate:change");var _e,qe={provide:Me,useExisting:h.forwardRef(function(){return Ke})},Ke=(s(Ze,_e=Me),Object.defineProperty(Ze.prototype,"node",{get:function(){return this.internalNode},set:function(e){var t=this;Ue("set: node",e.toJSON());var n=this.internalNode||e;this.internalNode=e,this.nodeComponentRef?this.ngZone.run(function(){t.nodeComponentRef.componentRef.instance.node=t.internalNode,t.nodeComponentRef.componentRef.changeDetectorRef.detectChanges()}):this.internalNode.data.equals(n.data)||this.render()},enumerable:!0,configurable:!0}),Ze.prototype.ngOnInit=function(){Ue("ngOnInit node",this.node.toJSON()),this.rootNode=this.elementRef.nativeElement},Ze.prototype.ngAfterViewInit=function(){var r=this;this.render(),this.differ=this.differs.find(this.nodeRefs).create(function(e,t){return t.rootNode}),this.differ.diff(this.nodeRefs),this.nodeRefs.changes.subscribe(function(){var e=r.differ.diff(r.nodeRefs);e&&e.forEachAddedItem(function(e){var t=e.item.rootNode,n=r.nodeComponentRef?r.nodeComponentRef.componentRef.instance.childrenContent.nativeElement:r.rootNode,o=Array.from(n.childNodes).filter(function(e){return e.hasAttribute("data-slate-object")||e.hasAttribute("data-slate-void")})[e.currentIndex];o?n.insertBefore(t,o):n.appendChild(t)})})},Ze.prototype.ngAfterViewChecked=function(){},Ze.prototype.getRelativeRange=function(e,t,n){if(n.isUnset)return null;var o,r,a,i,s,d,l,c,u,f=e.nodes.get(t),p=n.start,h=n.end,g=p.path,v=h.path,m=g.first(),y=v.first();return p=m===t?p.setPath(g.rest()):m<t&&t<=y?"text"===f.object?p.moveTo(b.PathUtils.create([t]),0).setKey(f.key):(o=O(f.texts(),1),a=(r=O(o[0],2))[0],i=r[1],p.moveTo(i,0).setKey(a.key)):null,h=y===t?h.setPath(v.rest()):m<=t&&t<y?"text"===f.object?(s=f.text.length,h.moveTo(b.PathUtils.create([t]),s).setKey(f.key)):(d=O(f.texts({direction:"backward"}),1),c=(l=O(d[0],2))[0],u=l[1],h.moveTo(u,c.text.length).setKey(c.key)):null,p&&h?n=(n=n.setAnchor(p)).setFocus(h):null},Ze.prototype.trackBy=function(e,t){return t.key+"_"+t.type},Ze.prototype.render=function(){var e,t;Ue.render("exec render",this.node.toJSON()),"block"===this.node.object?t="renderBlock":"document"===this.node.object?t="renderDocument":"inline"===this.node.object&&(t="renderInline");var n,o={editor:this.editor,isFocused:!!this.selection&&this.selection.isFocused,isSelected:!!this.selection,node:this.node,parent:null,readOnly:this.readOnly,children:this.nodeRefs,attributes:((e={})[f]=this.node.object,e[C]=this.node.key,e),nodeViewContainerRef:this.viewContainerRef},r=this.editor.run(t,o),a=null,a=r instanceof Fe?(this.nodeComponentRef=r,this.nodeComponentRef.rootNode):r;this.editor.isVoid(this.node)?(o.children=a,n=this.slaPluginRenderService.renderComponent(Le,Object.assign(o,{nodeRefs:this.nodeRefs})).rootNode,this.rootNode.replaceWith(n),this.rootNode=n):(this.rootNode.replaceWith(a),this.rootNode=a)},Ze.prototype.getNodeRef=function(o){return this.nodeRefs?this.nodeRefs.find(function(e,t,n){return t===o}):(m(!1,"nodeRefs is undefined."),null)},Ze.prototype.ngOnChanges=function(e){var t=this;(e.node||e.decorations||e.annotations||e.selection)&&this.memoSubNodes(),Ue.change("node changes",e);var n,o=e.selection;o&&!o.firstChange&&(!this.nodeComponentRef||(n=!!this.selection&&this.selection.isFocused)!==this.nodeComponentRef.componentRef.instance.isFocused&&this.ngZone.run(function(){t.nodeComponentRef.componentRef.instance.isFocused=n,t.nodeComponentRef.componentRef.changeDetectorRef.detectChanges()}))},Ze.prototype.ngDoCheck=function(){Ue.check("check node")},Ze.prototype.ngOnDestroy=function(){Ue("ngOnDestroy node"),this.rootNode.remove()},Ze.prototype.memoSubNodes=function(){for(var e=0;e<this.node.nodes.size;e++){var t=this.selection&&this.getRelativeRange(this.node,e,this.selection);t&&t.equals(this.subSelections[e])||(this.subSelections[e]=t)}},Ze.decorators=[{type:h.Component,args:[{selector:"sla-node,[slaNode]",template:'<ng-container *ngFor="let child of node.nodes; let i = index; trackBy: trackBy">\n    <span\n        *ngIf="child.object === \'text\'"\n        slaText\n        [attr.data-slate-object]="child.object"\n        [slaTextNode]="child"\n        [parent]="node"\n        [editor]="editor"\n        [attr.data-key]="child.key"\n    ></span>\n    <div\n        *ngIf="child.object !== \'text\'"\n        slaNode\n        [node]="child"\n        [selection]="subSelections[i]"\n        [editor]="editor"\n        [readOnly]="readOnly"\n    ></div>\n</ng-container>\n',changeDetection:h.ChangeDetectionStrategy.OnPush,providers:[qe]}]}],Ze.ctorParameters=function(){return[{type:h.ViewContainerRef},{type:h.ElementRef},{type:je},{type:h.NgZone},{type:h.IterableDiffers}]},Ze.propDecorators={editor:[{type:h.Input}],selection:[{type:h.Input}],block:[{type:h.Input}],index:[{type:h.Input}],nodeRef:[{type:h.Input}],readOnly:[{type:h.Input}],node:[{type:h.Input}],nodeRefs:[{type:h.ViewChildren,args:[Me]}]},Ze);function Ze(e,t,n,o,r){var a=_e.call(this)||this;return a.viewContainerRef=e,a.elementRef=t,a.slaPluginRenderService=n,a.ngZone=o,a.differs=r,a.subSelections=[],a.readOnly=!1,a.rendered=!0,a}var He=(ze.prototype.fromSlaEvents=function(e,t){return r.merge.apply(void 0,p(l.map(function(t){return r.fromEvent(e,t.name).pipe(n.map(function(e){return{event:e,eventEntity:t}}))}))).pipe(n.takeUntil(t))},ze.decorators=[{type:h.Injectable,args:[{providedIn:"root"}]}],ze.ngInjectableDef=h.ɵɵdefineInjectable({factory:function(){return new ze},token:ze,providedIn:"root"}),ze);function ze(){}var Xe=/Permission denied to access property "nodeType"/,Je=t("slate:content");Je.update=t("slate:update"),Je.render=t("slate:content-render"),Je.track=t("slate:track");var Ge=(Object.defineProperty(Ye.prototype,"slaValue",{set:function(e){this.isUpdateSelection=!0,Je.render("set: slateValue"),this.editorData=e},enumerable:!0,configurable:!0}),Ye.prototype.ngOnInit=function(){var a=this;this.rootNode=this.elementRef.nativeElement,this.document=this.editor.value.document,this.selection=this.editor.value.selection,this.ngZone.runOutsideAngular(function(){a.slaEventService.fromSlaEvents(a.rootNode,a.$destroy).subscribe(function(e){var t,n=e.event,o=e.eventEntity,r=n.target;r&&r.closest&&r.closest(N.SKIP_EVENT)||(!o.isTriggerBeforeInput||(t=Be(n.type,null,n,n.target))&&a.onEventHandle("onBeforeInput",t),o.handler&&a.onEventHandle(o.handler,n))}),r.fromEvent(window.document,"selectionchange").pipe(n.throttle(function(e){return r.interval(100)},{trailing:!0,leading:!0}),n.takeUntil(a.$destroy)).subscribe(function(e){a.onNativeSelectionChange(e)})})},Ye.prototype.onEventHandle=function(e,t){Je("slaEvent",e);var n=t.nativeEvent||t,o="keydown"===t.type&&(v.isUndo(n)||v.isRedo(n));if(!this.tmp.isUpdatingSelection&&!o||"onSelect"!==e&&"onBlur"!==e&&"onFocus"!==e){if(!K.IS_ANDROID&&"onSelect"===e){var r=this.editor.value.selection,a=q(t.target).getSelection(),i=this.editor.findRange(a);if(i&&i.equals(r.toRange()))return void this.updateSelection()}if(("onDragEnd"===e||"onDragEnter"===e||"onDragExit"===e||"onDragLeave"===e||"onDragOver"===e||"onDragStart"===e||"onDrop"===e)&&t.target.closest(N.EDITOR)!==this.rootNode)return;if("onBeforeInput"===e||"onBlur"===e||"onCompositionEnd"===e||"onCompositionStart"===e||"onCopy"===e||"onCut"===e||"onFocus"===e||"onInput"===e||"onKeyDown"===e||"onKeyUp"===e||"onPaste"===e||"onSelect"===e){var s=t.target?t.target:t.nativeEvent.target;if(!this.isInEditor(s))return}this.slaEvent(e,t)}},Ye.prototype.onNativeSelectionChange=function(e){var t,n;this.readOnly||(n=(t=q(e.target)).document.activeElement,Je.update("onNativeSelectionChange",{anchorOffset:t.getSelection().anchorOffset}),n===this.rootNode&&this.slaEvent("onSelect",e))},Ye.prototype.ngOnDestroy=function(){this.$destroy.next(),this.$destroy.complete()},Ye.prototype.updateSelection=function(){var e=this,t=this.editor.value.selection,n=t.isBackward,o=q(this.rootNode),r=o.getSelection(),a=o.document.activeElement;if(Je.update.enabled&&Je.update("updateSelection",{selection:t.toJSON()}),r){var i=r.rangeCount,s=r.anchorNode,d=!1;if(t.isBlurred&&a===this.rootNode&&(this.rootNode.blur(),d=!0),t.isUnset&&i&&this.isInEditor(s)&&(d=!0),t.isFocused&&a!==this.rootNode&&(this.rootNode.focus({preventScroll:!0}),d=!0),t.isFocused&&t.isSet){var l=!!r.rangeCount&&r.getRangeAt(0),c=this.editor.findDOMRange(t);if(!c)return void m(!1,"Unable to find a native DOM range from the current selection.");var u=c.startContainer,f=c.startOffset,p=c.endContainer,h=c.endOffset;if(l&&(u===l.startContainer&&f===l.startOffset&&p===l.endContainer&&h===l.endOffset||u===l.endContainer&&f===l.endOffset&&p===l.startContainer&&h===l.startOffset))return;d=!0,this.tmp.isUpdatingSelection=!0,r.setBaseAndExtent?n?r.setBaseAndExtent(c.endContainer,c.endOffset,c.startContainer,c.startOffset):r.setBaseAndExtent(c.startContainer,c.startOffset,c.endContainer,c.endOffset):r.addRange(c),Je.track("track end : updateSelection"),re(r),setTimeout(function(){K.IS_FIREFOX&&e.rootNode&&e.rootNode.focus(),e.tmp.isUpdatingSelection=!1,Je.update("updateSelection:setTimeout",{anchorOffset:o.getSelection().anchorOffset})}),d&&(Je.enabled||Je.update.enabled)&&(Je("updateSelection",{selection:t,"native":r,activeElement:a}),Je.update("updateSelection:applied",{selection:t.toJSON(),"native":{anchorOffset:r.anchorOffset,focusOffset:r.focusOffset}}))}}},Ye.prototype.isInEditor=function(e){var t;try{t=3===e.nodeType?e.parentNode:e}catch(n){if(K.IS_FIREFOX&&Xe.test(n.message))return!1;throw n}return t.isContentEditable&&(t===this.rootNode||t.closest(N.EDITOR)===this.rootNode)},Ye.prototype.ngAfterViewChecked=function(){var e=this;this.isUpdateSelection&&(this.isUpdateSelection=!1,this.ngZone.runOutsideAngular(function(){e.updateSelection()}))},Ye.decorators=[{type:h.Component,args:[{selector:"sla-content,[slaContent]",template:'<sla-node\n    [editor]="editor"\n    [node]="editorData.document"\n    [selection]="editorData.selection"\n    [readOnly]="readOnly"\n></sla-node>\n',changeDetection:h.ChangeDetectionStrategy.OnPush}]}],Ye.ctorParameters=function(){return[{type:h.NgZone},{type:h.ElementRef},{type:h.ChangeDetectorRef},{type:He}]},Ye.propDecorators={nodeRef:[{type:h.ViewChild,args:[Ke,{"static":!0}]}],readOnly:[{type:h.Input}],slaValue:[{type:h.Input}],editor:[{type:h.Input}],slaEvent:[{type:h.Input}]},Ye);function Ye(e,t,n,o){this.ngZone=e,this.elementRef=t,this.cdr=n,this.slaEventService=o,this.$destroy=new r.Subject,this.hasSpaceKeypress=!1,this.isComposing=!1,this.isUpdateSelection=!1,this.readOnly=!1,this.tmp={isUpdatingSelection:!1,contentKey:0}}var $e=(Qe.decorators=[{type:h.Injectable}],Qe.ctorParameters=function(){return[{type:je}]},Qe);function Qe(e){var t=this;this.slaPluginRenderService=e,this.renderBlock=function(e){return t.slaPluginRenderService.renderDom("div",e.children,e.attributes,{position:"relative"})},this.renderDocument=function(e){return t.slaPluginRenderService.renderDom("div",e.children,e.attributes)},this.renderInline=function(e){return t.slaPluginRenderService.renderDom("span",e.children,e.attributes)}}var et=(tt.prototype.ngOnInit=function(){var t=this;this.setEditorContainerClass();var n=this.slaValue,o=this.slaReadOnly;this.ngZone.runOutsideAngular(function(){var e=te(t);t.editor=new b.Editor({plugins:p(e,[t.rendering]),onChange:function(e){t.slaOnChange.emit(e)},value:n,readOnly:o}),t.editor.tmp.contentRef=t.contentRef,t.slaEditorInitComplete.emit(t.editor)})},tt.prototype.slaEvent=function(e,t){this.editor.run(e,t)},tt.prototype.setEditorContainerClass=function(){var e,t=["sla-editor-container"];this.slaContainerClass&&t.push(this.slaContainerClass),(e=this.element.nativeElement.classList).add.apply(e,p(t))},tt.decorators=[{type:h.Component,args:[{selector:"sla-editor,[slaEditor]",template:'<div\n    slaContent\n    class="sla-editor-container"\n    [readOnly]="slaReadOnly"\n    [editor]="editor"\n    [slaEvent]="slaEvent"\n    [slaValue]="slaValue"\n    [attr.tabIndex]="tabIndex"\n    [attr.contenteditable]="slaReadOnly ? null : true"\n    [attr.data-slate-editor]="true"\n    [attr.data-key]="slaValue?.document?.key"\n    [attr.spellcheck]="spellcheck"\n></div>\n'}]}],tt.ctorParameters=function(){return[{type:h.NgZone},{type:h.Renderer2},{type:h.ElementRef},{type:$e}]},tt.propDecorators={slaValue:[{type:h.Input}],slaReadOnly:[{type:h.Input}],slaPlaceholder:[{type:h.Input}],spellcheck:[{type:h.Input}],tabIndex:[{type:h.Input}],slaContainerClass:[{type:h.Input}],plugins:[{type:h.Input}],commands:[{type:h.Input}],queries:[{type:h.Input}],schema:[{type:h.Input}],decorateNode:[{type:h.Input}],renderAnnotation:[{type:h.Input}],renderBlock:[{type:h.Input}],renderDecoration:[{type:h.Input}],renderDocument:[{type:h.Input}],renderEditor:[{type:h.Input}],renderInline:[{type:h.Input}],renderMark:[{type:h.Input}],onBeforeInput:[{type:h.Input}],onBlur:[{type:h.Input}],onClick:[{type:h.Input}],onContextMenu:[{type:h.Input}],onCompositionEnd:[{type:h.Input}],onCompositionStart:[{type:h.Input}],onCopy:[{type:h.Input}],onCut:[{type:h.Input}],onDragEnd:[{type:h.Input}],onDragEnter:[{type:h.Input}],onDragLeave:[{type:h.Input}],onDragOver:[{type:h.Input}],onDragStart:[{type:h.Input}],onDrop:[{type:h.Input}],onInput:[{type:h.Input}],onFocus:[{type:h.Input}],onKeyDown:[{type:h.Input}],onKeyUp:[{type:h.Input}],onMouseDown:[{type:h.Input}],onMouseUp:[{type:h.Input}],onPaste:[{type:h.Input}],onSelect:[{type:h.Input}],slaOnChange:[{type:h.Output}],slaEditorInitComplete:[{type:h.Output}],contentRef:[{type:h.ViewChild,args:[Ge,{"static":!0}]}]},tt);function tt(e,t,n,o){this.ngZone=e,this.render2=t,this.element=n,this.rendering=o,this.spellcheck=!1,this.plugins=[],this.slaOnChange=new h.EventEmitter,this.slaEditorInitComplete=new h.EventEmitter,this.tmp={mounted:!1,change:null,resolves:0,updates:0,contentRef:null}}var nt=/^([\w-]+)(?::(\d+))?$/;var ot={parse:function(e){var t=nt.exec(e);if(!t)throw new Error('Invalid offset key string "'+e+'".');var n=O(t,3),o=(n[0],n[1]),r=n[2];return{key:o,index:parseInt(r,10)}},stringify:function(e){return e.key+":"+e.index}},rt=t("slate:text");rt.check=t("slate:docheck");var at,it={provide:Me,useExisting:h.forwardRef(function(){return st})},st=(s(dt,at=Me),Object.defineProperty(dt.prototype,"slaTextNode",{get:function(){return this.node},set:function(e){rt("set: slaTextNode",e.toJSON()),this.leafContainer&&this.node&&this.node.marks&&!this.node.marks.equals(e.marks)?(this.node=e,this.detectTextTemplate(),this.renderLeaf()):(this.node=e,this.detectTextTemplate())},enumerable:!0,configurable:!0}),dt.prototype.ngOnInit=function(){rt("ngOnInit"),this.offsetKey=ot.stringify({key:this.node.key,index:0}),this.rootNode=this.elementRef.nativeElement,this.detectTextTemplate(),this.renderLeaf()},dt.prototype.ngOnChanges=function(e){},dt.prototype.renderLeaf=function(){var r=this,a=this.leafContainer.nativeElement;this.node.marks.forEach(function(e){var t,n=r.buildConfig(((t={})[f]="mark",t),a,null,null,e),o=r.editor.run("renderMark",n);o&&(a=o)}),this.lastContentElement&&this.lastContentElement!==this.leafContainer.nativeElement&&this.lastContentElement.remove(),this.elementRef.nativeElement.appendChild(a),this.lastContentElement=a},dt.prototype.detectTextTemplate=function(){var e;this.isZeroWidthString=!1,this.zeroWidthStringLength=0,this.isLineBreak=!1,this.isTrailing=!1,this.editor.query("isVoid",this.parent)?(this.zeroWidthStringLength=this.parent.text.length,this.setZeroWidthElement()):""===this.node.text&&"block"===this.parent.object&&""===this.parent.text&&this.parent.nodes.last()===this.node?(this.isLineBreak=!0,this.setZeroWidthElement()):""===this.node.text?this.setZeroWidthElement():(e=this.node.text.charAt(this.node.text.length-1),this.isTrailing="\n"===e)},dt.prototype.setZeroWidthElement=function(){this.isZeroWidthString=!0;var e=this.leafContainer.nativeElement.querySelector(""+N.STRING);e&&e.remove()},dt.prototype.buildConfig=function(e,t,n,o,r){return{editor:this.editor,marks:this.node.marks,node:this.node,offset:0,text:this.node.text,children:t,attributes:e,annotation:n,decoration:o,mark:r}},dt.prototype.ngDoCheck=function(){rt.check("check text",this.node)},dt.decorators=[{type:h.Component,args:[{selector:"sla-text,[slaText]",template:'<span #leaf [attr.data-slate-leaf]="true" [attr.data-offset-key]="offsetKey">\n    \x3c!-- break compisiton input --\x3e\n    \x3c!-- <span contenteditable="false" class="non-editable-area"></span> --\x3e\n    \x3c!-- move zero order to adjust empty text selection when delete last char--\x3e\n    <span #text *ngIf="!isZeroWidthString" data-slate-string="true">{{ node.text }}{{ isTrailing ? \'\\n\' : null }}</span>\n    <span\n        *ngIf="isZeroWidthString"\n        attr.data-slate-zero-width="{{ isLineBreak ? \'n\' : \'z\' }}"\n        attr.data-slate-length="{{ zeroWidthStringLength }}"\n        >{{ \'\\u200B\' }}<br *ngIf="isLineBreak" />\n    </span>\n</span>\n',providers:[it],changeDetection:h.ChangeDetectionStrategy.OnPush}]}],dt.ctorParameters=function(){return[{type:h.ElementRef},{type:h.ChangeDetectorRef},{type:h.NgZone}]},dt.propDecorators={editor:[{type:h.Input}],parent:[{type:h.Input}],block:[{type:h.Input}],slaTextNode:[{type:h.Input}],leafContainer:[{type:h.ViewChild,args:["leaf",{"static":!0}]}]},dt);function dt(e,t,n){var o=at.call(this)||this;return o.elementRef=e,o.cdr=t,o.ngZone=n,o.offsets=[],o.zeroWidthStringLength=0,o.isLineBreak=!1,o.isTrailing=!1,o}var lt=(ct.decorators=[{type:h.NgModule,args:[{declarations:[et,Ge,Ke,Le,st],imports:[o.BrowserModule,a.PortalModule],exports:[et,Ge,Ke,st,Le],entryComponents:[st,Le],providers:[$e]}]}],ct.ctorParameters=function(){return[]},ct);function ct(){}var ut=function(){},ft=(pt.prototype.initPluginComponent=function(){this.insertChildrenView(),this.setNodeAttributes(this.elementRef.nativeElement,this.attributes)},pt.prototype.getData=function(e){return this.node.data.get(e)},pt.prototype.isNodeChange=function(e){var t=e.node;return!(!t||t.isFirstChange)},pt.prototype.updateHostClass=function(e){for(var t in e){var n,o;e.hasOwnProperty(t)&&(n=e[t],o=this.elementRef.nativeElement.classList,n?o.contains(t)||o.add(t):o.contains(t)&&o.remove(t))}},pt.prototype.setNodeAttributes=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setAttribute(n,t[n])},pt.prototype.insertChildrenView=function(){var e,t;if(this.childrenContent){var n=this.children.toArray();try{for(var o=y(n),r=o.next();!r.done;r=o.next()){var a=r.value;this.childrenContent.nativeElement.appendChild(a.rootNode)}}catch(i){e={error:i}}finally{try{r&&!r.done&&(t=o["return"])&&t.call(o)}finally{if(e)throw e.error}}}},pt.prototype.removeNode=function(e){e.preventDefault();var t=this.editor.value.document.getPath(this.node.key),n=(n=this.editor.value.document.getPreviousBlock(t))||this.editor.value.document.getNextBlock(t);this.editor.focus().moveToEndOfNode(n),this.editor.removeNodeByKey(this.node.key)},pt.propDecorators={editor:[{type:h.Input}],node:[{type:h.Input}],parent:[{type:h.Input}],isFocused:[{type:h.Input}],isSelected:[{type:h.Input}],readOnly:[{type:h.Input}],children:[{type:h.Input}],attributes:[{type:h.Input}],nodeViewContainerRef:[{type:h.Input}],childrenContent:[{type:h.ViewChild,args:["childrenContent",{read:h.ElementRef,"static":!0}]}]},pt);function pt(e){this.elementRef=e}e.ɵb=Ge,e.ɵa=et,e.ɵd=Ke,e.ɵc=qe,e.ɵk=st,e.ɵj=it,e.ɵi=Le,e.ɵe=Me,e.ɵg=He,e.ɵf=je,e.ɵh=$e,e.SlaEditorComponent=et,e.SlaContentComponent=Ge,e.nodeBinding=qe,e.SlaNodeComponent=Ke,e.textBinding=it,e.SlaTextComponent=st,e.SlaVoidComponent=Le,e.SlaEditorModule=lt,e.ValueChange=ut,e.SlaLeafRenderConfig=Ae,e.SlaNodeRenderConfig=Pe,e.SlaNestedNodeRef=Fe,e.SlaPluginRenderService=je,e.SlaPluginComponentBase=ft,e.SlaEventService=He,e.cloneFragment=k,e.findDOMNode=function(e,t){void 0===t&&(t=window),m(!1,"As of slate-react@0.22 the `findDOMNode(key)` helper is deprecated in favor of `editor.findDOMNode(path)`."),Node.isNode(e)&&(e=e.key);var n=t.document.querySelector("["+C+'="'+e+'"]');if(!n)throw new Error('Unable to find a DOM node for "'+e+'". This is often because of forgetting to add `props.attributes` to a custom component.');return n},e.getEventTransfer=j,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-slate-core.umd.min.js.map