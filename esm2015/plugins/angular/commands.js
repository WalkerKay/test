class CommandsPlugin {
    static reconcileNode(editor, node) {
        const { value } = editor;
        const { document, selection } = value;
        const path = document.getPath(node.key);
        const domElement = editor.findDOMNode(path);
        const block = document.getClosestBlock(path);
        // Get text information
        const { text } = node;
        let { textContent: domText } = domElement;
        const isLastNode = block.nodes.last() === node;
        const lastChar = domText.charAt(domText.length - 1);
        // COMPAT: If this is the last leaf, and the DOM text ends in a new line,
        // we will have added another new line in <Leaf>'s render method to account
        // for browsers collapsing a single trailing new lines, so remove it.
        if (isLastNode && lastChar === '\n') {
            domText = domText.slice(0, -1);
        }
        // If the text is no different, abort.
        if (text === domText)
            return;
        let entire = selection.moveAnchorTo(path, 0).moveFocusTo(path, text.length);
        entire = document.resolveRange(entire);
        // Change the current value to have the leaf's text replaced.
        editor.insertTextAtRange(entire, domText, node.marks);
        return;
    }
    static reconcileDOMNode(editor, domNode) {
        const domElement = domNode.parentElement.closest('[data-key]');
        const node = editor.findNode(domElement);
        editor.reconcileNode(node);
    }
    // slate origin remove mark method
    static removeMarkOrigin(editor, mark) {
        const { value } = editor;
        const { document, selection, anchorText } = value;
        if (selection.isExpanded) {
            editor.removeMarkAtRange(selection, mark);
        }
        else if (selection.marks) {
            const marks = selection.marks.remove(mark);
            const sel = selection.set('marks', marks);
            editor.select(sel);
        }
        else {
            const marks = document.getActiveMarksAtRange(selection).remove(mark);
            const sel = selection.set('marks', marks);
            editor.select(sel);
        }
    }
    static removeMark(editor, mark) {
        const { value } = editor;
        const { document, selection, anchorText } = value;
        if (selection.isExpanded) {
            editor.removeMarkAtRange(selection, mark);
        }
        else if (selection.marks) {
            const marks = selection.marks.remove(mark);
            const sel = selection.set('marks', marks);
            editor.select(sel);
        }
        else {
            const marks = document.getActiveMarksAtRange(selection).remove(mark);
            const sel = selection.set('marks', marks);
            editor.select(sel);
        }
        // The cursor position is still in mark when mark is cancelled
        if (selection.isCollapsed && anchorText.text === '\u200B') {
            editor.removeMarkByPath(selection.start.path, 0, 1, mark);
        }
        if (selection.isCollapsed && anchorText.text !== '\u200B' && anchorText.text !== '') {
            editor.insertText('\u200B');
        }
    }
    static addMark(editor, mark) {
        const { value } = editor;
        const { document, selection, anchorText } = value;
        if (selection.isExpanded) {
            editor.addMarkAtRange(selection, mark);
        }
        else if (selection.marks) {
            const marks = selection.marks.add(mark);
            const sel = selection.set('marks', marks);
            editor.select(sel);
        }
        else {
            const marks = document.getActiveMarksAtRange(selection).add(mark);
            const sel = selection.set('marks', marks);
            editor.select(sel);
        }
        // The cursor position is still in mark when mark is cancelled
        if (selection.isCollapsed && anchorText.text === '\u200B') {
            editor.addMarkByPath(selection.start.path, 0, 1, mark);
        }
        if (selection.isCollapsed && anchorText.text !== '\u200B' && anchorText.text !== '') {
            editor.insertText('\u200B');
        }
    }
}
export default {
    commands: CommandsPlugin
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbWFuZHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd4LXNsYXRlL2NvcmUvIiwic291cmNlcyI6WyJwbHVnaW5zL2FuZ3VsYXIvY29tbWFuZHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsTUFBTSxjQUFjO0lBRWhCLE1BQU0sQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLElBQUk7UUFDN0IsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLE1BQU0sQ0FBQztRQUN6QixNQUFNLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUN0QyxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUV4QyxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVDLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFN0MsdUJBQXVCO1FBQ3ZCLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUM7UUFDdEIsSUFBSSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsR0FBRyxVQUFVLENBQUM7UUFFMUMsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxJQUFJLENBQUM7UUFDL0MsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRXBELHlFQUF5RTtRQUN6RSwyRUFBMkU7UUFDM0UscUVBQXFFO1FBQ3JFLElBQUksVUFBVSxJQUFJLFFBQVEsS0FBSyxJQUFJLEVBQUU7WUFDakMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbEM7UUFFRCxzQ0FBc0M7UUFDdEMsSUFBSSxJQUFJLEtBQUssT0FBTztZ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SyxDQUFDLENBQUM7WUFDMUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUN0QjtRQUVELDhEQUE4RDtRQUM5RCxJQUFJLFNBQVMsQ0FBQyxXQUFXLElBQUksVUFBVSxDQUFDLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDdkQsTUFBTSxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQzFEO1FBQ0QsSUFBSSxTQUFTLENBQUMsV0FBVyxJQUFJLFVBQVUsQ0FBQyxJQUFJLEtBQUssUUFBUSxJQUFJLFVBQVUsQ0FBQyxJQUFJLEtBQUssRUFBRSxFQUFFO1lBQ2pGLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDL0I7SUFDTCxDQUFDO0NBQ0o7QUFFRCxlQUFlO0lBQ1gsUUFBUSxFQUFFLGNBQWM7Q0FDM0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVkaXRvciB9IGZyb20gJ3NsYXRlJztcblxuY2xhc3MgQ29tbWFuZHNQbHVnaW4ge1xuXG4gICAgc3RhdGljIHJlY29uY2lsZU5vZGUoZWRpdG9yLCBub2RlKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IGVkaXRvcjtcbiAgICAgICAgY29uc3QgeyBkb2N1bWVudCwgc2VsZWN0aW9uIH0gPSB2YWx1ZTtcbiAgICAgICAgY29uc3QgcGF0aCA9IGRvY3VtZW50LmdldFBhdGgobm9kZS5rZXkpO1xuXG4gICAgICAgIGNvbnN0IGRvbUVsZW1lbnQgPSBlZGl0b3IuZmluZERPTU5vZGUocGF0aCk7XG4gICAgICAgIGNvbnN0IGJsb2NrID0gZG9jdW1lbnQuZ2V0Q2xvc2VzdEJsb2NrKHBhdGgpO1xuXG4gICAgICAgIC8vIEdldCB0ZXh0IGluZm9ybWF0aW9uXG4gICAgICAgIGNvbnN0IHsgdGV4dCB9ID0gbm9kZTtcbiAgICAgICAgbGV0IHsgdGV4dENvbnRlbnQ6IGRvbVRleHQgfSA9IGRvbUVsZW1lbnQ7XG5cbiAgICAgICAgY29uc3QgaXNMYXN0Tm9kZSA9IGJsb2NrLm5vZGVzLmxhc3QoKSA9PT0gbm9kZTtcbiAgICAgICAgY29uc3QgbGFzdENoYXIgPSBkb21UZXh0LmNoYXJBdChkb21UZXh0Lmxlbmd0aCAtIDEpO1xuXG4gICAgICAgIC8vIENPTVBBVDogSWYgdGhpcyBpcyB0aGUgbGFzdCBsZWFmLCBhbmQgdGhlIERPTSB0ZXh0IGVuZHMgaW4gYSBuZXcgbGluZSxcbiAgICAgICAgLy8gd2Ugd2lsbCBoYXZlIGFkZGVkIGFub3RoZXIgbmV3IGxpbmUgaW4gPExlYWY+J3MgcmVuZGVyIG1ldGhvZCB0byBhY2NvdW50XG4gICAgICAgIC8vIGZvciBicm93c2VycyBjb2xsYXBzaW5nIGEgc2luZ2xlIHRyYWlsaW5nIG5ldyBsaW5lcywgc28gcmVtb3ZlIGl0LlxuICAgICAgICBpZiAoaXNMYXN0Tm9kZSAmJiBsYXN0Q2hhciA9PT0gJ1xcbicpIHtcbiAgICAgICAgICAgIGRvbVRleHQgPSBkb21UZXh0LnNsaWNlKDAsIC0xKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIHRoZSB0ZXh0IGlzIG5vIGRpZmZlcmVudCwgYWJvcnQuXG4gICAgICAgIGlmICh0ZXh0ID09PSBkb21UZXh0KSByZXR1cm47XG5cbiAgICAgICAgbGV0IGVudGlyZSA9IHNlbGVjdGlvbi5tb3ZlQW5jaG9yVG8ocGF0aCwgMCkubW92ZUZvY3VzVG8ocGF0aCwgdGV4dC5sZW5ndGgpO1xuXG4gICAgICAgIGVudGlyZSA9IGRvY3VtZW50LnJlc29sdmVSYW5nZShlbnRpcmUpO1xuXG4gICAgICAgIC8vIENoYW5nZSB0aGUgY3VycmVudCB2YWx1ZSB0byBoYXZlIHRoZSBsZWFmJ3MgdGV4dCByZXBsYWNlZC5cbiAgICAgICAgZWRpdG9yLmluc2VydFRleHRBdFJhbmdlKGVudGlyZSwgZG9tVGV4dCwgbm9kZS5tYXJrcyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzdGF0aWMgcmVjb25jaWxlRE9NTm9kZShlZGl0b3IsIGRvbU5vZGUpIHtcbiAgICAgICAgY29uc3QgZG9tRWxlbWVudCA9IGRvbU5vZGUucGFyZW50RWxlbWVudC5jbG9zZXN0KCdbZGF0YS1rZXldJyk7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBlZGl0b3IuZmluZE5vZGUoZG9tRWxlbWVudCk7XG4gICAgICAgIGVkaXRvci5yZWNvbmNpbGVOb2RlKG5vZGUpO1xuICAgIH1cblxuICAgIC8vIHNsYXRlIG9yaWdpbiByZW1vdmUgbWFyayBtZXRob2RcbiAgICBzdGF0aWMgcmVtb3ZlTWFya09yaWdpbihlZGl0b3IsIG1hcmspIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gZWRpdG9yO1xuICAgICAgICBjb25zdCB7IGRvY3VtZW50LCBzZWxlY3Rpb24sIGFuY2hvclRleHQgfSA9IHZhbHVlO1xuXG4gICAgICAgIGlmIChzZWxlY3Rpb24uaXNFeHBhbmRlZCkge1xuICAgICAgICAgICAgZWRpdG9yLnJlbW92ZU1hcmtBdFJhbmdlKHNlbGVjdGlvbiwgbWFyayk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0aW9uLm1hcmtzKSB7XG4gICAgICAgICAgICBjb25zdCBtYXJrcyA9IHNlbGVjdGlvbi5tYXJrcy5yZW1vdmUobWFyayk7XG4gICAgICAgICAgICBjb25zdCBzZWwgPSBzZWxlY3Rpb24uc2V0KCdtYXJrcycsIG1hcmtzKTtcbiAgICAgICAgICAgIGVkaXRvci5zZWxlY3Qoc2VsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG1hcmtzID0gZG9jdW1lbnQuZ2V0QWN0aXZlTWFya3NBdFJhbmdlKHNlbGVjdGlvbikucmVtb3ZlKG1hcmspO1xuICAgICAgICAgICAgY29uc3Qgc2VsID0gc2VsZWN0aW9uLnNldCgnbWFya3MnLCBtYXJrcyk7XG4gICAgICAgICAgICBlZGl0b3Iuc2VsZWN0KHNlbCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgcmVtb3ZlTWFyayhlZGl0b3IsIG1hcmspIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gZWRpdG9yO1xuICAgICAgICBjb25zdCB7IGRvY3VtZW50LCBzZWxlY3Rpb24sIGFuY2hvclRleHQgfSA9IHZhbHVlO1xuXG4gICAgICAgIGlmIChzZWxlY3Rpb24uaXNFeHBhbmRlZCkge1xuICAgICAgICAgICAgZWRpdG9yLnJlbW92ZU1hcmtBdFJhbmdlKHNlbGVjdGlvbiwgbWFyayk7XG4gICAgICAgIH0gZWxzZSBpZiAoc2VsZWN0aW9uLm1hcmtzKSB7XG4gICAgICAgICAgICBjb25zdCBtYXJrcyA9IHNlbGVjdGlvbi5tYXJrcy5yZW1vdmUobWFyayk7XG4gICAgICAgICAgICBjb25zdCBzZWwgPSBzZWxlY3Rpb24uc2V0KCdtYXJrcycsIG1hcmtzKTtcbiAgICAgICAgICAgIGVkaXRvci5zZWxlY3Qoc2VsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG1hcmtzID0gZG9jdW1lbnQuZ2V0QWN0aXZlTWFya3NBdFJhbmdlKHNlbGVjdGlvbikucmVtb3ZlKG1hcmspO1xuICAgICAgICAgICAgY29uc3Qgc2VsID0gc2VsZWN0aW9uLnNldCgnbWFya3MnLCBtYXJrcyk7XG4gICAgICAgICAgICBlZGl0b3Iuc2VsZWN0KHNlbCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGUgY3Vyc29yIHBvc2l0aW9uIGlzIHN0aWxsIGluIG1hcmsgd2hlbiBtYXJrIGlzIGNhbmNlbGxlZFxuICAgICAgICBpZiAoc2VsZWN0aW9uLmlzQ29sbGFwc2VkICYmIGFuY2hvclRleHQudGV4dCA9PT0gJ1xcdTIwMEInKSB7XG4gICAgICAgICAgICBlZGl0b3IucmVtb3ZlTWFya0J5UGF0aChzZWxlY3Rpb24uc3RhcnQucGF0aCwgMCwgMSwgbWFyayk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNlbGVjdGlvbi5pc0NvbGxhcHNlZCAmJiBhbmNob3JUZXh0LnRleHQgIT09ICdcXHUyMDBCJyAmJiBhbmNob3JUZXh0LnRleHQgIT09ICcnKSB7XG4gICAgICAgICAgICBlZGl0b3IuaW5zZXJ0VGV4dCgnXFx1MjAwQicpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGFkZE1hcmsoZWRpdG9yLCBtYXJrKSB7XG4gICAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IGVkaXRvcjtcbiAgICAgICAgY29uc3QgeyBkb2N1bWVudCwgc2VsZWN0aW9uLCBhbmNob3JUZXh0IH0gPSB2YWx1ZTtcblxuICAgICAgICBpZiAoc2VsZWN0aW9uLmlzRXhwYW5kZWQpIHtcbiAgICAgICAgICAgIGVkaXRvci5hZGRNYXJrQXRSYW5nZShzZWxlY3Rpb24sIG1hcmspO1xuICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdGlvbi5tYXJrcykge1xuICAgICAgICAgICAgY29uc3QgbWFya3MgPSBzZWxlY3Rpb24ubWFya3MuYWRkKG1hcmspO1xuICAgICAgICAgICAgY29uc3Qgc2VsID0gc2VsZWN0aW9uLnNldCgnbWFya3MnLCBtYXJrcyk7XG4gICAgICAgICAgICBlZGl0b3Iuc2VsZWN0KHNlbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBtYXJrcyA9IGRvY3VtZW50LmdldEFjdGl2ZU1hcmtzQXRSYW5nZShzZWxlY3Rpb24pLmFkZChtYXJrKTtcbiAgICAgICAgICAgIGNvbnN0IHNlbCA9IHNlbGVjdGlvbi5zZXQoJ21hcmtzJywgbWFya3MpO1xuICAgICAgICAgICAgZWRpdG9yLnNlbGVjdChzZWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVGhlIGN1cnNvciBwb3NpdGlvbiBpcyBzdGlsbCBpbiBtYXJrIHdoZW4gbWFyayBpcyBjYW5jZWxsZWRcbiAgICAgICAgaWYgKHNlbGVjdGlvbi5pc0NvbGxhcHNlZCAmJiBhbmNob3JUZXh0LnRleHQgPT09ICdcXHUyMDBCJykge1xuICAgICAgICAgICAgZWRpdG9yLmFkZE1hcmtCeVBhdGgoc2VsZWN0aW9uLnN0YXJ0LnBhdGgsIDAsIDEsIG1hcmspO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZWxlY3Rpb24uaXNDb2xsYXBzZWQgJiYgYW5jaG9yVGV4dC50ZXh0ICE9PSAnXFx1MjAwQicgJiYgYW5jaG9yVGV4dC50ZXh0ICE9PSAnJykge1xuICAgICAgICAgICAgZWRpdG9yLmluc2VydFRleHQoJ1xcdTIwMEInKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICAgIGNvbW1hbmRzOiBDb21tYW5kc1BsdWdpblxufTtcbiJdfQ==